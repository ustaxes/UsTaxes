# State Tax Guide - Multi-State Tax Return Automation

Comprehensive guide for preparing state income tax returns across all US states and territories.

## Overview

State income tax systems vary significantly:
- **9 states:** No state income tax
- **41 states + DC:** Income tax (rates and structures vary)
- **Most states:** Start with federal Adjusted Gross Income (AGI)
- **Some states:** Have their own calculations

## States Without Income Tax

These 9 states have NO state income tax on wages:
1. **Alaska**
2. **Florida**
3. **Nevada**
4. **New Hampshire** (taxes dividends and interest only, ending in 2025)
5. **South Dakota**
6. **Tennessee** (eliminated income tax in 2021)
7. **Texas**
8. **Washington** (capital gains tax on high earners only)
9. **Wyoming**

**Note:** Even these states may have other taxes (sales, property, etc.).

## State Tax Structures

### 1. Flat Tax States (Single Rate)

All income taxed at the same rate:

| State | Rate | Notes |
|-------|------|-------|
| **Colorado** | 4.4% | Flat rate since 2020 |
| **Illinois** | 4.95% | Flat rate |
| **Indiana** | 3.05% | Flat rate + county tax |
| **Kentucky** | 4.5% | Flat rate since 2024 |
| **Massachusetts** | 5.0% | 4% surtax on income >$1M |
| **Michigan** | 4.25% | Flat rate |
| **North Carolina** | 4.5% | Flat rate since 2024 |
| **Pennsylvania** | 3.07% | Flat rate + local tax |
| **Utah** | 4.55% | Flat rate |

### 2. Graduated Tax States (Progressive)

Tax rates increase with income (like federal):

**High-Tax States:**
- **California:** 1% - 13.3% (highest in nation)
- **Hawaii:** 1.4% - 11%
- **New York:** 4% - 10.9% (+ NYC tax 3.078% - 3.876%)
- **New Jersey:** 1.4% - 10.75%
- **Oregon:** 4.75% - 9.9%
- **Minnesota:** 5.35% - 9.85%
- **DC:** 4% - 10.75%
- **Vermont:** 3.35% - 8.75%

**Moderate-Tax States:**
- **Georgia:** 1% - 5.75%
- **Virginia:** 2% - 5.75%
- **Arizona:** 2.5% - 4.5%
- **Wisconsin:** 3.5% - 7.65%
- **Idaho:** 1% - 5.8%

### 3. States with Local Income Taxes

Some states allow cities/counties to impose additional income taxes:

**Ohio:**
- State: 0% - 3.75%
- Local: Up to 3% (varies by city)
- Cleveland: 2.5%
- Columbus: 2.5%

**Pennsylvania:**
- State: 3.07%
- Local: Up to 3.9%
- Philadelphia: 3.8398%
- Pittsburgh: 3%

**Indiana:**
- State: 3.05%
- County: 0.5% - 3%

**Maryland:**
- State: 2% - 5.75%
- County: 2.25% - 3.2%

**New York:**
- State: 4% - 10.9%
- NYC: 3.078% - 3.876%
- Yonkers: 16.75% of state tax

## Common State Tax Concepts

### Starting Point: Federal AGI

Most states start with **federal Adjusted Gross Income (AGI)** from Form 1040, Line 11.

**Process:**
1. Start with federal AGI
2. Add state-specific additions
3. Subtract state-specific subtractions
4. Calculate state taxable income
5. Apply state tax brackets or flat rate
6. Calculate tax
7. Apply state credits
8. Calculate refund or amount owed

### State Additions to Federal AGI

Common additions (varies by state):
- **Municipal bond interest** from other states (tax-free federally, taxable by state)
- **State tax refund** deducted federally (if itemized)
- **401(k) withdrawals** (some states)
- **Social Security benefits** (some states)
- **Federal deductions** not allowed by state

### State Subtractions from Federal AGI

Common subtractions (varies by state):
- **Social Security benefits** (many states exempt)
- **State/local pension income** (many states exempt their own)
- **Military retirement pay** (many states exempt)
- **Municipal bond interest** from that state (tax-free)
- **State-specific deductions**

### State Standard Deduction

States have their own standard deductions:
- Some states match federal deduction
- Some states have different amounts
- Some states have no standard deduction (use federal itemized deductions)

**Examples (2024):**
- **California:** $5,363 (single), $10,726 (MFJ)
- **New York:** $8,000 (single), $16,050 (MFJ)
- **Georgia:** $12,000 (single), $24,000 (MFJ)

### State Itemized Deductions

Most states allow itemized deductions but with differences:
- **SALT deduction:** Not applicable (can't deduct state taxes on state return)
- **Mortgage interest:** Usually allowed
- **Charitable contributions:** Usually allowed
- **Medical expenses:** Varies by state
- **Miscellaneous deductions:** Varies (many states eliminated)

### State Personal Exemptions

Some states have personal exemptions (even though federal eliminated in 2018):
- **California:** $134 per exemption
- **Oregon:** $213 per exemption
- **Many states:** Eliminated or built into standard deduction

### State Tax Credits

Common state credits:
- **Earned Income Tax Credit (EITC):** Many states have their own (% of federal)
- **Child tax credit:** Some states
- **Education credits:** Varies
- **Property tax credit:** Some states
- **Retirement income credit:** Some states
- **Pass-through entity tax (PTET) credit:** Many states (for business owners)

## Major State Details

### California

**Form:** 540 (Resident), 540NR (Nonresident)

**Tax Rates (2024):**
- 1% on $0 - $10,412 (single)
- ...up to...
- 13.3% on $1,000,000+ (highest rate)

**Key Differences from Federal:**
- Lower standard deduction
- State mortgage interest deduction limit: $1M
- SDI (State Disability Insurance) deductible on state return
- Mental Health Services Tax (1% surtax on $1M+ income)

**Credits:**
- California EITC
- Young child tax credit
- Foster youth tax credit
- Renter's credit

**Special Rules:**
- Community property state
- Domestic partners treated as married
- Different rules for stock options

### New York

**Form:** IT-201 (Resident), IT-203 (Nonresident)

**Tax Rates (2024):**
- 4% on $0 - $8,500 (single)
- ...up to...
- 10.9% on $25,000,000+

**NYC Tax (additional):**
- 3.078% - 3.876% for NYC residents

**Key Differences:**
- State standard deduction different from federal
- PTET credit (for business owners)
- College tuition credit
- Real property tax credit

**Credits:**
- NY State EITC (30% of federal)
- NYC EITC
- Child and dependent care credit
- Empire State child credit

### Texas

**No state income tax.**

**However:**
- Franchise tax on businesses
- High property taxes
- High sales taxes

### Florida

**No state income tax.**

### New Jersey

**Form:** NJ-1040

**Tax Rates (2024):**
- 1.4% on $0 - $20,000 (single)
- ...up to...
- 10.75% on $1,000,000+

**Key Differences:**
- Different standard deduction
- Property tax deduction/credit (significant)
- Retirement income exclusions (up to $100,000)
- Veteran exemptions

**Credits:**
- NJ EITC (40% of federal)
- Child tax credit
- Property tax credit (up to $50)

### Pennsylvania

**Form:** PA-40

**Tax Rate:** 3.07% (flat)

**Key Differences:**
- NO standard deduction
- NO personal exemptions
- Eight classes of income (taxed differently)
- Retirement income excluded
- Interest and dividends excluded

**Eight Classes of Income:**
1. Compensation (wages)
2. Interest
3. Dividends
4. Net profits from business
5. Net gains from disposition of property
6. Rents and royalties
7. Estate or trust income
8. Gambling and lottery winnings

**Local Taxes:**
Most PA residents also pay local earned income tax (varies by municipality).

### Illinois

**Form:** IL-1040

**Tax Rate:** 4.95% (flat)

**Key Differences:**
- Retirement income excluded (pension, 401k, IRA)
- Social Security excluded
- No state EITC
- Property tax credit available

### Massachusetts

**Form:** Form 1

**Tax Rate:** 5% (+ 4% surtax on income >$1M)

**Key Differences:**
- Part A income (wages, business): 5%
- Part B income (interest, dividends, short-term gains): 5%
- Long-term capital gains: 5%
- Surtax: 4% on income >$1M
- Social Security excluded

**Credits:**
- EITC (40% of federal)
- Senior circuit breaker (property tax credit)
- Dependent care credit

### Washington

**No state income tax on wages.**

**Capital Gains Tax:**
- 7% on capital gains >$250,000 per year
- Applies to high earners only
- Certain exemptions (real estate, retirement accounts, etc.)

## Multi-State Taxation

### Part-Year Residents

If you moved during the year:

**Two Returns:**
1. Part-year return for old state (income while resident)
2. Part-year return for new state (income while resident)

**Allocation:**
- Allocate income by date
- W-2 income: Use pay dates
- Business income: Apportion by days/months

**Example:**
- Lived in Virginia Jan-Jun (6 months)
- Moved to Texas July-Dec (6 months)
- Total W-2 income: $100,000

**Virginia return:**
- Report $50,000 (6 months)
- Part-year resident form

**Texas return:**
- No return (no state income tax)

### Nonresident Income

If you work in one state but live in another:

**Nonresident Return:**
File in state where you earned income (work state).

**Resident Return:**
File in state where you live (home state).

**Credit for Taxes Paid:**
Home state usually gives credit for taxes paid to work state.

**Example:**
- Live in New Jersey
- Work in New York
- Earned $100,000 in New York

**New York return (nonresident):**
- Report $100,000 NY income
- Pay NY tax: $6,000

**New Jersey return (resident):**
- Report $100,000 total income
- NJ tax before credit: $5,500
- Credit for NY tax paid: $5,500
- NJ tax after credit: $0

**Net result:** Pay $6,000 to NY, $0 to NJ (total: $6,000)

### Reciprocal Agreements

Some states have agreements where residents don't pay tax in the work state:

**Examples:**
- **Illinois ↔ Iowa, Kentucky, Michigan, Wisconsin**
- **Indiana ↔ Kentucky, Michigan, Ohio, Pennsylvania, Wisconsin**
- **Maryland ↔ Pennsylvania, Virginia, West Virginia, DC**
- **Pennsylvania ↔ Indiana, Maryland, New Jersey, Ohio, Virginia, West Virginia**
- **Virginia ↔ Kentucky, Maryland, Pennsylvania, West Virginia, DC**
- **DC ↔ Maryland, Virginia**

**How it works:**
- Claim exemption in work state (Form W-4 equivalent)
- Only pay tax to home state
- No nonresident return needed for work state

**Example:**
- Live in Pennsylvania
- Work in New Jersey
- Reciprocal agreement exists
- Only file PA return (no NJ return)

### Remote Work

**General Rule:**
- Tax based on where work is performed
- Work from home in Pennsylvania for NY company = PA income (not NY)

**Exceptions:**
- **Convenience of Employer Rule** (NY, NE, DE, CT, NJ, PA, AR)
  - If work from home for your convenience (not employer's requirement), work state may still tax
  - Example: Live in NJ, work from home for NY company = NY may tax

**Post-COVID:**
- Many states issued guidance on remote work
- "Temporary" remote work during COVID had special rules
- Check specific state guidance

## State Tax Planning

### 1. State of Residency

**Domicile vs. Residency:**
- **Domicile:** Your permanent home (only one)
- **Residency:** Where you live (can have multiple)

**State Residency Tests:**
- **Permanent home:** Where is your primary residence?
- **183-day rule:** Many states tax if present 183+ days
- **Voter registration:** Where registered?
- **Driver's license:** Which state?
- **Intent:** Where do you intend to live permanently?

**Change Residency to Save Taxes:**
- Move from high-tax state (CA, NY, NJ) to no-tax state (FL, TX, NV)
- Establish domicile: Buy home, get driver's license, register to vote
- Cut ties with old state: Sell home, change bank accounts
- **Important:** High-tax states scrutinize these moves (especially NY, CA)

### 2. Timing of Income

**If moving to lower-tax state:**
- Defer income until after move (bonuses, stock options, etc.)
- Accelerate deductions before move

**If moving to higher-tax state:**
- Accelerate income before move
- Defer deductions until after move

### 3. Retirement Account Withdrawals

States that don't tax retirement income:
- **Pennsylvania:** No tax on IRA, 401k, pension
- **Illinois:** No tax on retirement income
- **Mississippi:** No tax on IRA, 401k
- **Many others:** Partial exemptions

**Strategy:**
- If retiring, consider moving to retirement-friendly state
- Time withdrawals based on state tax

### 4. Capital Gains

**States with no capital gains tax:**
- 9 states with no income tax (FL, TX, WA*, etc.)
- (*WA has special capital gains tax on $250k+)

**Strategy:**
- If large capital gain, consider establishing residency in no-tax state before sale
- Must be bona fide resident (not temporary)

### 5. Municipal Bonds

**Strategy:**
- Buy bonds from your state = tax-free federally AND state
- Buy bonds from other state = tax-free federally, taxable by state

**Example:**
- CA resident
- CA muni bond: Tax-free federal and state
- NY muni bond: Tax-free federal, taxable by CA

## State Tax Automation Requirements

### Data Needed

**Personal Information:**
- State of residence
- Days in each state (if multiple)
- Part-year resident dates (if applicable)
- County/city (for local tax)

**Income:**
- W-2s (with state wages and withholding)
- State-allocated income (if multiple states)
- Nonresident income by state

**Deductions:**
- State-specific deductions
- Standard vs. itemized (state level)

**Credits:**
- State EITC
- State child tax credit
- Property tax credits
- Other state credits

**Prior Year:**
- State refund received (may be taxable federally)
- Carryover credits

### State-Specific Calculations

**For each state, implement:**
1. Starting point (federal AGI or other)
2. State additions
3. State subtractions
4. State standard/itemized deductions
5. State exemptions
6. State tax calculation (brackets or flat)
7. State credits
8. State withholding
9. State payments/estimates
10. Refund or amount owed

### Common State Forms

Most states have similar form structures:

**Main Form:**
- State equivalent of Form 1040
- Usually called "Form 540", "IT-201", "IL-1040", etc.

**Schedules:**
- **Schedule A:** State itemized deductions (if different from federal)
- **Schedule X:** Part-year/nonresident allocation
- **Schedule CR:** Credits
- **Various schedules:** State-specific items

**Supporting Forms:**
- State W-2
- State 1099 (if different from federal)
- State K-1s

## Implementation Strategy

### Priority States (by population)

1. **California** (39M) - Complex, high rates
2. **Texas** (30M) - No income tax
3. **Florida** (22M) - No income tax
4. **New York** (19M) - Complex, high rates, NYC tax
5. **Pennsylvania** (13M) - Flat rate, complex classes
6. **Illinois** (12M) - Flat rate, simple
7. **Ohio** (12M) - Complex, local taxes
8. **Georgia** (11M) - Graduated rates
9. **North Carolina** (11M) - Flat rate
10. **Michigan** (10M) - Flat rate

**Implement in order:**
1. No-tax states (simple - no return needed)
2. Flat-rate states (simpler calculations)
3. Graduated-rate states (more complex)
4. States with local taxes (most complex)

### State Tax Rules Database

Create database of state tax rules:

```json
{
  "states": {
    "CA": {
      "name": "California",
      "hasIncomeTax": true,
      "taxStructure": "graduated",
      "form": "540",
      "brackets": {
        "single": [
          {"rate": 0.01, "min": 0, "max": 10412},
          {"rate": 0.02, "min": 10413, "max": 24684},
          ...
        ]
      },
      "standardDeduction": {
        "single": 5363,
        "married": 10726
      },
      "startsWith": "federalAGI",
      "additions": ["otherStateMuniBonds", "federalStateTaxRefund"],
      "subtractions": ["socialSecurity", "caStateBonds"],
      "credits": ["EITC", "youngChild", "renter"]
    },
    "FL": {
      "name": "Florida",
      "hasIncomeTax": false
    },
    ...
  }
}
```

### State Form Templates

Create templates for each state's forms:
- Main form (state 1040 equivalent)
- Schedule A (itemized deductions)
- Schedule X (part-year/nonresident)
- Credits schedule

### Validation Rules

State-specific validation:
- SSN format (some states have different rules)
- County codes (for local tax)
- Filing status (some states have different options)
- Residency requirements

## Testing

### Test Cases Needed

**For each state:**
1. Single filer, W-2 only
2. Married filing jointly, W-2s
3. Part-year resident
4. Nonresident with in-state income
5. Multiple states (credit for taxes paid)
6. Self-employment income (Schedule C)
7. Rental income (Schedule E)
8. Capital gains (Schedule D)
9. Credits (EITC, child tax credit, etc.)
10. Local tax (if applicable)

## Resources

**Official Sources:**
- Each state's Department of Revenue website
- State tax forms and instructions
- State tax rate schedules

**Research Tools:**
- Tax Foundation (state tax rankings)
- CCH State Tax Handbook
- Bloomberg Tax (state tax research)

**Software:**
- TurboTax State (for comparison)
- H&R Block State
- FreeTaxUSA State (free for many states)

## Questions to Ask Users

When preparing state returns:

1. **Residency:**
   - Which state(s) did you live in during the tax year?
   - Did you move? If so, what dates?
   - Which state is your domicile (permanent home)?
   - How many days in each state?

2. **Work Location:**
   - Which state(s) did you work in?
   - Work from home? If so, for which state's employer?
   - Any business travel to other states?

3. **Income by State:**
   - How much income earned in each state?
   - Have state W-2s showing state wages?
   - Any income from states where you don't live?

4. **Local Tax:**
   - Live in a city with local income tax?
   - What city and/or county?
   - Have local tax withheld?

5. **State Deductions:**
   - Pay property taxes? (for state credit)
   - Make state-specific deductions (529 plans, etc.)?

6. **State Credits:**
   - Eligible for state EITC?
   - Have qualifying children for state child tax credit?
   - Pay for child care (state credit)?
   - Other state credits?

7. **Prior Year:**
   - Receive state refund last year? (may be taxable federally)
   - Have carryover credits?
   - Have carryover losses (state-level)?

---

**Last Updated:** 2024 Tax Year
**Scope:** All 50 states + DC
**Priority:** Top 10 states by population cover 50% of US population
